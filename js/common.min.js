/*!
 * $Id: common.js 2531 2010-08-17 18:41:34Z mloftis $
 *
 * Common javascript, eg page ready.
 * Must be loaded AFTER the jQuery modules.
 */
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(d){var e=this.length;var f=Number(arguments[1])||0;f=(f<0)?Math.ceil(f):Math.floor(f);if(f<0){f+=e}for(;f<e;f++){if(f in this&&this[f]===d){return f}}return -1};
/*!
     * Tag Selector plugin for jQuery: Facilitates selecting multiple tags by extending jQuery UI Autocomplete.
     * You may use Tag Selector under the terms of either the MIT License or the GNU General Public License (GPL) Version 2.
     * https://petprojects.googlecode.com/svn/trunk/MIT-LICENSE.txt
     * https://petprojects.googlecode.com/svn/trunk/GPL-LICENSE.txt
     */
}(function(b){b.fn.tagSelector=function(d,a){return this.each(function(){var f=b(this),c=b("input[type=text]",this);f.click(function(){c.focus()}).delegate(".tag a","click",function(){b(this).parent().remove()});c.keydown(function(e){if(e.keyCode===9&&b(this).data("autocomplete").menu.active){e.preventDefault()}}).autocomplete({minLength:0,source:d,select:function(j,e){var k=b('<span class="tag"/>').text(e.item.toString()+" ").append("<a>\u00D7</a>").append(b('<input type="hidden"/>').attr("name",a).val(e.item.id)).insertBefore(c);b("<span>").text(" ").insertAfter(k);return true}});c.data("autocomplete")._renderItem=function(h,e){return b("<li/>").data("item.autocomplete",e).append(b("<a/>").text(e.toString())).appendTo(h)};c.data("autocomplete")._resizeMenu=function(h,e){h=this.menu.element;h.outerWidth(Math.max(h.width("").outerWidth(),f.outerWidth()))}})}})(jQuery);var ratingStarsRunOn=[];function getCookieVal(c){var d=document.cookie.indexOf(";",c);if(d==-1){d=document.cookie.length}return unescape(document.cookie.substring(c,d))}function GetCookie(l){var g=l+"=";var j=g.length;var h=document.cookie.length;var k=0;while(k<h){var m=k+j;if(document.cookie.substring(k,m)==g){return getCookieVal(m)}k=document.cookie.indexOf(" ",k)+1;if(k===0){break}}return null}function ratingStars(d){var c={style:d.rating_style,curvalue:d.current_rating,maxvalue:d.max_rating,isStatic:d.rating_static,statid:$("#"+d.div_name+"res"),fbkid:$("#"+d.div_name+"fbk"),numvotes:d.numvotes};if(ratingStarsRunOn.indexOf(d.div_name)==-1){ratingStarsRunOn.push(d.div_name);$("div#"+d.div_name).sp3rater(d.rating_callback_url,c)}}var loadpieceInfo={lasturl:null};function loadPaginatedPiece(d,c){loadpieceInfo.lasturl=d;$(c).load(d,function(){var a=c+" a";a=c+" a.clickclass";$(a).click(function(){var b=$(this).attr("href");loadPaginatedPiece(b,c);return false})})}var trace="111";var THUMBS_HTTP_ROOT="";var thumb_t_ID=null;var thumb_t_selected=null;console.log("значение ",trace);$(document).ready(function(){trace="222";console.log("значение ",trace);$("#related_video .videolist:nth-child(4n)").addClass("last");var m=[];$.preLoadImages=function(b){for(var a=0;a<b.length;a++){console.log("m= ",a);var c=document.createElement("img");c.src=b[a];m.push(c);trace="333";console.log("значение ",trace)}};$.cicleThumbsfrom=function(a){thumb_t_selected++;if(thumb_t_selected>=a.thumbs.length){thumb_t_selected=1;trace="444";console.log("значение ",trace)}a.attr("src",a.thumbs[thumb_t_selected]);trace="444123";console.log("значение ",trace);console.log("e.attr= ",a);console.log("e.thumbs= ",a.thumbs);console.log("thumb_t_selected= ",thumb_t_selected)};try{trace="555";console.log("значение ",trace);$("img.rotate-thumbs").livequery("mouseenter",function(){trace="666";console.log("значение ",trace);clearInterval(thumb_t_ID);var b=$(this);console.log("e= ",b);console.log("this= ",this);console.log("e.metadata()= ",b.metadata());var a=b.metadata();console.log("h= ",a);b.thumbs=new Array();i=0;console.log("!!!");console.log("h.ethumbs=  ",a.ethumbs);for(thumb in a.ethumbs){console.log("i=  ",i);b.thumbs[i]=THUMBS_HTTP_ROOT+a.ethumbs[thumb];i++}console.log("e.thumbs=  ",b.thumbs);console.log("h.ethumbs=  ",a.ethumbs);$.preLoadImages(b.thumbs);$.cicleThumbsfrom(b);thumb_t_ID=setInterval(function(){$.cicleThumbsfrom(b)},500)})}catch(q){trace="777";console.log("значение ",trace);console.log("c= ",q)}try{trace="888";console.log("значение ",trace);$("img.rotate-thumbs").livequery("mouseleave",function(){var b=$(this);var a=b.metadata();b.attr("src",THUMBS_HTTP_ROOT+a.selected_thumb);clearInterval(thumb_t_ID);thumb_t_selected=null;trace="999";console.log("значение ",trace);console.log("e.attr= ",b)})}catch(q){trace="101010";console.log("значение ",trace);console.log("c2= ",q)}$("#social>div.twitter>a").click(function(){var a=$(this);window.open("https://twitter.com/intent/follow?original_referer="+window.location+"&screen_name="+a.attr("rel")+"&source=followbutton&variant=2.0","share","width=450,height=500,location=no");return false});$("#social>div.plusone>a").attr("target","_newtab").attr("href","https://plusone.google.com/_/+1/confirm?hl=en&url="+window.location);var e=("placeholder" in document.createElement("input"));$("[placeholder]").focus(function(){var a=$(this);a.removeClass("placeholder");if(a.val()==a.attr("placeholder")&&!e){if(!("placeholder" in document.createElement("input"))){a.val("")}}}).blur(function(){var a=$(this);if(a.val()===""){a.addClass("placeholder")}if(a.val()===""&&!e){a.val(a.attr("placeholder"))}}).blur().parents("form").submit(function(){$(this).find("[placeholder]").each(function(){if(e){return}var a=$(this);if(a.hasClass("placeholder")){a.val("")}})});function s(a,b){var c=$("<div>").text(a);c.dialog({width:400,modal:true,resizable:false,title:b,closeText:"hide",buttons:{OK:function(){c.dialog("close")}}}).dialog("show")}$("#userprofile #removefromfriends, #userprofile #cancelfriendship").click(function o(c){c.preventDefault();var f=$(this);var b=$("<div id='removeuserdialog'>Are you sure you want to delete this friend?</div>");b.dialog({width:400,modal:true,resizable:false,title:"Delete Friend",closeText:"hide",buttons:{Yes:function d(){$.ajax({url:"/changefriend/"+f.attr("rel")+"/delete",success:function g(k){$("#userprofile .userinfo .action").removeClass("accepted pending ignored none").addClass("none");b.dialog("close");s("This person is deleted from your friends list.","Friend Deleted")},error:function j(k){s("There was an error deleting friend. Please try again.","Error");b.close()}})},No:function a(){b.dialog("close")}}}).dialog("show");return false});$("#userprofile #addtofriends").click(function p(d){d.preventDefault();var a=$(this);var b=$("<div id='adduserdialog' class='dialog'>");b.load("/addfriend #form",function c(){var f=b.find("form");b.find(".action, .title").hide();b.find("#id_friends_username").val(a.attr("rel")).parent().hide();f.submit(function g(){d.preventDefault();$.ajax({data:f.serialize()+"&is_json=1",url:"/addfriend",type:"post",success:function l(t){if(t.error){s(t.error,"Error")}else{$("#userprofile .userinfo .action").removeClass("accepted pending ignored none").addClass(t.status);$("#userprofile #removefromfriends, #userprofile #cancelfriendship").attr("rel",t.pk);b.dialog("close");s("A friendship request has been sent.","Friend Request Sent")}},error:function u(t){s("There was an error adding friend. Please try again.","Error");b.close()}});return false});b.dialog({width:400,modal:true,resizable:false,title:"Add Friend",closeText:"hide",buttons:{Submit:function k(){f.submit()},Cancel:function j(){b.dialog("close")}}}).dialog("show")})});$("#id_niche","#upload_form").change(function(){var a=$(this);$(".categories").find(".colsmall").hide().end().find(".niche-"+a.val()).show()}).val("1").change();if(typeof tags_list!=="undefined"){$("select#id_categories").removeProp("multiple");$("#id_tags","#upload_form").tagSelector(tags_list,"tags")}$(".tab-container").each(function(){var b=$(this);b.find(".tab-nav").children("a").click(function(d){var c=$(this).attr("href");b.find(".selected").removeClass("selected");$(c+"-tab").addClass("selected");$(this).addClass("selected")});var a=$(".wm-links-footer").find('a[href*="#"]');a.click(function(d){var c="#"+$(this).attr("href").split("#")[1];b.find(".selected").removeClass("selected");$(c+"-tab").addClass("selected");b.find('a[href="'+c+'"]').addClass("selected")});if(document.location.hash&&b.find(document.location.hash+"-tab").length){b.find(".selected").removeClass("selected");b.find("[href="+document.location.hash+"]").addClass("selected");$(document.location.hash+"-tab").addClass("selected")}});$("#upload_form").submit(function(){var a=$(this);var b=[];var c=$("#id_tags_selector");$("span.tag",c).each(function(){var d=$(this);var f=d.find("input[type='hidden']");if(f.val()==-1){b.push(d.data("text"));f.remove()}});if(b.length){$.jsonRPC.request("tags.createTags",{params:[JSON.stringify(b)],success:function(f){var g=f.result.taglist;for(var d in g){$('<input type="hidden" name="tags">').val(g[d].id).appendTo(c)}a.unbind("submit");a.trigger("submit")}})}else{return true}return false});$("#id_tags_selector","#upload_form").each(function(){var a=[];$("#id_tags option").each(function(){var b=$(this);a.push({id:b.attr("value"),text:b.text(),selected:b.is(":selected")})});$("#id_tags").remove();$(this).tagSelector({source:a,name:"tags",create:function(c,b){$.jsonRPC.setup({endPoint:"/json/",namespace:""});$.jsonRPC.request("tags.isValidTagName",{params:[c],success:function(d){if(d.result.result){b()}else{alert("This tag is not allowed")}}})}})});if($(".show-more-toggle.load-more").length){var n=1;var h=$("#video-details").attr("data-id");$(".show-more-toggle.load-more").click(function(){$(this).hide();$(".show-more-toggle.loading").show();$.ajax({url:"/load_more_comments/video/"+h+"/",data:{paginate_by:10,page:parseInt(n+1),o:"-submit_date"},success:function(a){n++;$(".show-comments-toggle").before(a.comments_html);$(".comments-item:hidden").not(".comment-form-container").slideDown("slow",function(){if(a.last_page){$(".show-comments-toggle").hide()}else{$(".show-more-toggle.loading").hide();$(".show-more-toggle.load-more").show()}})},error:function(){$(".show-comments-toggle").hide()}})})}$("#videoviewtabs").find("a").click(function(){$("#videoviewtabs").find("li").removeClass("active");$(this).closest("li").addClass("active");var a="#"+$(this).attr("rel");location.hash=a;$("#extracontent>div.section").not(a).hide();$(a).show();return false});if(location.hash){var r=location.hash.substring(1);$("#videoviewtabs").find("a[rel="+r+"]").click()}});